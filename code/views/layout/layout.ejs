<!DOCTYPE html>
<html lang="<%= locale %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= __('app.title') %></title>
    <link rel="icon" type="image/x-icon" href="/images/favicon/favicon.ico">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- App CSS -->
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/terminal.css">

    <!-- JS Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

    <!-- GraphiQL Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/graphiql@3.0.6/graphiql.min.css" />
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/graphiql@3.0.6/graphiql.min.js"></script>

    <!-- i18n para JavaScript frontend -->
    <script>
        window.i18n = {
            locale: '<%= locale %>',
            translations: <%- JSON.stringify({
                nav: __('nav'),
                table: __('table'),
                terminal: __('terminal'),
                validation: __('validation'),
                confirm: __('confirm'),
                errors: __('errors'),
                buttons: __('buttons'),
                connection: __('connection'),
                responseTypes: __('responseTypes'),
                httpCodes: __('httpCodes'),
                import: __('import'),
                bulk: __('bulk'),
                duplicate: __('duplicate'),
                actions: __('actions'),
                criteriaHelp: __('criteriaHelp'),
                form: __('form'),
                requestTester: __('requestTester')
            }) %>
        };

        // Helper function para traducciones en JS
        function t(key, params = {}) {
            const keys = key.split('.');
            let value = window.i18n.translations;
            for (const k of keys) {
                if (value && typeof value === 'object' && k in value) {
                    value = value[k];
                } else {
                    return key;
                }
            }
            if (typeof value === 'string') {
                Object.entries(params).forEach(([param, val]) => {
                    value = value.replace(new RegExp(`{{${param}}}`, 'g'), val);
                });
            }
            return value || key;
        }
    </script>
</head>
<body>
    <%- include('../partials/header.ejs') %>
    <main><%- body %></main>
    <%- include('../partials/footer.ejs') %>

    <!-- Toast container -->
    <div id="toastContainer" class="toast-container"></div>

    <style>
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
        pointer-events: none;
      }
      .toast-notification {
        pointer-events: auto;
        display: flex;
        align-items: flex-start;
        gap: 10px;
        min-width: 300px;
        max-width: 450px;
        padding: 14px 18px;
        border-radius: var(--border-radius-sm, 8px);
        background: var(--bg-card, #1e293b);
        border: 1px solid var(--border-color, #334155);
        color: var(--text-primary, #f1f5f9);
        font-size: 0.9rem;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        transform: translateX(120%);
        opacity: 0;
        transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.35s ease;
      }
      .toast-notification.toast-show {
        transform: translateX(0);
        opacity: 1;
      }
      .toast-notification.toast-hide {
        transform: translateX(120%);
        opacity: 0;
      }
      .toast-icon {
        font-size: 1.1rem;
        margin-top: 1px;
        flex-shrink: 0;
      }
      .toast-body {
        flex: 1;
        line-height: 1.4;
        word-break: break-word;
      }
      .toast-close {
        background: none;
        border: none;
        color: var(--text-secondary, #94a3b8);
        cursor: pointer;
        font-size: 1rem;
        padding: 0;
        line-height: 1;
        flex-shrink: 0;
      }
      .toast-close:hover {
        color: var(--text-primary, #f1f5f9);
      }
      .toast-success { border-left: 4px solid var(--success, #10b981); }
      .toast-success .toast-icon { color: var(--success, #10b981); }
      .toast-error { border-left: 4px solid var(--danger, #ef4444); }
      .toast-error .toast-icon { color: var(--danger, #ef4444); }
      .toast-warning { border-left: 4px solid var(--warning, #f59e0b); }
      .toast-warning .toast-icon { color: var(--warning, #f59e0b); }
      .toast-info { border-left: 4px solid var(--primary, #6366f1); }
      .toast-info .toast-icon { color: var(--primary, #6366f1); }
    </style>

    <script>
      function showToast(message, type = 'info', duration = 4000) {
        const icons = {
          success: 'fa-check-circle',
          error: 'fa-exclamation-circle',
          warning: 'fa-exclamation-triangle',
          info: 'fa-info-circle'
        };

        const toast = document.createElement('div');
        toast.className = `toast-notification toast-${type}`;
        toast.innerHTML = `
          <i class="fa ${icons[type] || icons.info} toast-icon"></i>
          <span class="toast-body">${message}</span>
          <button class="toast-close" onclick="this.parentElement.classList.replace('toast-show','toast-hide');setTimeout(()=>this.parentElement.remove(),350)">&times;</button>
        `;

        document.getElementById('toastContainer').appendChild(toast);
        requestAnimationFrame(() => {
          requestAnimationFrame(() => toast.classList.add('toast-show'));
        });

        if (duration > 0) {
          setTimeout(() => {
            if (toast.parentElement) {
              toast.classList.replace('toast-show', 'toast-hide');
              setTimeout(() => toast.remove(), 350);
            }
          }, duration);
        }
      }
    </script>
</body>
</html>
