<!-- Modal Lista Pendientes -->
<div class="modal fade modal-modern" id="modalLista" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="titleModalList"><i class="fa fa-clock-o me-2"></i><%= __('modal.pendingRequests') %></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="pendingListContainer">
          <% listaEspera.forEach(function(element) { %>
          <div class="pending-item" id="pl-<%= element.id %>"
               data-id="<%= element.id %>"
               data-response="<%= element.defaultResponse || '' %>"
               data-type="<%= element.tiporespuesta || 'json' %>"
               data-code="<%= element.codigo || 200 %>"
               data-headers="<%= element.customHeaders || '{}' %>"
               data-original-response="<%= element.originalResponse || '' %>"
               data-original-type="<%= element.originalType || 'json' %>"
               data-original-code="<%= element.originalCode || 200 %>"
               data-original-headers="<%= element.originalHeaders || '{}' %>"
               data-conditions="<%= element.conditions ? encodeURIComponent(JSON.stringify(element.conditions)) : '' %>">
            <div class="pending-item-header">
              <div class="pending-item-info">
                <span class="badge-method badge-method-<%= (element.method || 'GET').toLowerCase() %>"><%= element.method || 'GET' %></span>
                <span class="pending-item-url"><%= element.url %></span>
                <span class="pending-item-date"><%= element.date %></span>
              </div>
              <div class="pending-item-actions">
                <button class="btn-icon btn-icon-info" onclick="toggleRequestHeaders('<%= element.id %>')" title="<%= __('pending.viewRequestHeaders') %>">
                  <i class="fa fa-list-ul" aria-hidden="true"></i>
                </button>
                <button class="btn-icon btn-icon-primary" onclick="togglePendingResponse('<%= element.id %>')" title="<%= __('modal.editResponse') %>">
                  <i class="fa fa-pencil" aria-hidden="true"></i>
                </button>
                <button class="btn-icon btn-icon-success" onclick="iniciaTarea('<%= element.id %>')" title="<%= __('modal.releaseRequest') %>">
                  <i class="fa fa-play" aria-hidden="true"></i>
                </button>
              </div>
            </div>
            <!-- Request Headers (collapsible) -->
            <div class="pending-request-headers" id="prqh-<%= element.id %>" style="display: none;">
              <div class="request-headers-title"><%= __('pending.requestHeaders') %></div>
              <div class="request-headers-list">
                <% if (element.requestHeaders) { %>
                  <% Object.entries(element.requestHeaders).forEach(function([key, value]) { %>
                    <div class="request-header-item">
                      <span class="request-header-key"><%= key %>:</span>
                      <span class="request-header-value"><%= value %></span>
                    </div>
                  <% }); %>
                <% } else { %>
                  <div class="request-headers-empty"><%= __('pending.noRequestHeaders') %></div>
                <% } %>
              </div>
            </div>
            <div class="pending-item-response" id="pr-<%= element.id %>" style="display: none;">
              <% if (element.conditions && element.conditions.length > 0) { %>
              <div class="form-group-modern pending-condition-selector">
                <label class="form-label-modern" for="prcs-<%= element.id %>"><%= __('pending.selectCondition') %></label>
                <select class="form-control-modern" id="prcs-<%= element.id %>" onchange="selectConditionResponse('<%= element.id %>', this.value)">
                  <option value="current"><%= __('pending.currentResponse') %></option>
                  <option value="original"><%= __('pending.originalResponse') %></option>
                  <% element.conditions.forEach(function(cond, index) { %>
                  <option value="<%= index %>" data-codigo="<%= cond.codigo || '' %>" data-tipo="<%= cond.tiporespuesta || '' %>" data-respuesta="<%= encodeURIComponent(cond.respuesta || '') %>" data-headers="<%= encodeURIComponent(cond.customHeaders || '') %>"><%= cond.nombre %></option>
                  <% }); %>
                </select>
              </div>
              <% } %>
              <div class="pending-response-row">
                <div class="form-group-modern pending-code-group">
                  <label class="form-label-modern" for="prc-<%= element.id %>"><%= __('pending.code') %></label>
                  <input type="number" class="form-control-modern" id="prc-<%= element.id %>" name="prc-<%= element.id %>" value="<%= element.codigo || 200 %>" min="100" max="599">
                </div>
                <div class="form-group-modern pending-type-group">
                  <label class="form-label-modern" for="prtype-<%= element.id %>"><%= __('pending.type') %></label>
                  <select class="form-control-modern" id="prtype-<%= element.id %>" name="prtype-<%= element.id %>" onchange="togglePendingFormatBtn('<%= element.id %>')">
                    <option value="json" <%= element.tiporespuesta === 'json' ? 'selected' : '' %>>JSON</option>
                    <option value="xml" <%= element.tiporespuesta === 'xml' ? 'selected' : '' %>>XML</option>
                    <option value="soap" <%= element.tiporespuesta === 'soap' ? 'selected' : '' %>>SOAP</option>
                    <option value="text" <%= element.tiporespuesta === 'text' ? 'selected' : '' %>>Texto</option>
                    <option value="html" <%= element.tiporespuesta === 'html' ? 'selected' : '' %>>HTML</option>
                  </select>
                </div>
              </div>
              <div class="form-group-modern">
                <label class="form-label-modern" for="prt-<%= element.id %>"><%= __('pending.responseBody') %></label>
                <textarea class="form-control-modern" id="prt-<%= element.id %>" name="prt-<%= element.id %>" rows="6" placeholder="<%= __('form.placeholder.leaveEmpty') %>"><%= element.defaultResponse || '' %></textarea>
              </div>
              <div class="form-group-modern">
                <label class="form-label-modern" for="prh-<%= element.id %>"><%= __('pending.customHeadersJson') %></label>
                <textarea class="form-control-modern" id="prh-<%= element.id %>" name="prh-<%= element.id %>" rows="3" placeholder="<%= __('form.placeholder.headersJson') %>"><%= element.customHeaders || '' %></textarea>
              </div>
              <div class="pending-response-actions">
                <button class="btn-modern btn-modern-secondary btn-sm" onclick="resetPendingResponse('<%= element.id %>')">
                  <i class="fa fa-undo"></i> <%= __('buttons.restore') %>
                </button>
                <button class="btn-modern btn-modern-primary btn-sm" id="prfmt-<%= element.id %>" onclick="formatPendingContent('<%= element.id %>')" style="<%= !['json', 'xml', 'soap', 'html'].includes(element.tiporespuesta) ? 'display:none' : '' %>">
                  <i class="fa fa-align-left"></i> <%= __('buttons.format') %>
                </button>
              </div>
            </div>
          </div>
          <% }) %>
        </div>
        <% if (listaEspera.length === 0) { %>
        <div class="empty-state" id="pendingEmptyState">
          <i class="fa fa-check-circle"></i>
          <p><%= __('pending.noPending') %></p>
        </div>
        <% } %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern btn-modern-secondary" data-bs-dismiss="modal"><%= __('buttons.close') %></button>
      </div>
    </div>
  </div>
</div>
